<h1 class="text-3xl font-bold mb-6"><%= tournament ? 'Modifier le Tournoi' : 'Créer un Tournoi' %></h1>

<form action="/admin/tournaments<%= tournament ? '/' + tournament.id : '' %>" method="POST" class="p-6 rounded-lg shadow-md space-y-8" enctype="multipart/form-data">

    <!-- Section: Informations Générales -->
    <div class="glass-card p-6 rounded-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Informations Générales</h2>
        <div class="mb-4">
            <label for="name" class="block text-gray-300 text-sm font-bold mb-2">Nom du Tournoi:</label>
            <input type="text" id="name" name="name" value="<%= tournament ? tournament.name : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
        </div>

        <div class="mb-4">
            <label for="description" class="block text-gray-300 text-sm font-bold mb-2">Description:</label>
            <textarea id="description" name="description" rows="5" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required><%= tournament ? tournament.description : '' %></textarea>
        </div>

        <div class="mb-4">
            <label for="whatsappGroupLink" class="block text-gray-300 text-sm font-bold mb-2">Lien du groupe WhatsApp (optionnel):</label>
            <input type="url" id="whatsappGroupLink" name="whatsappGroupLink" value="<%= tournament ? tournament.whatsappGroupLink : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" placeholder="https://chat.whatsapp.com/...">
        </div>

        <div class="mb-6 flex items-center">
            <input type="checkbox" id="isActive" name="isActive" class="mr-2 leading-tight" <%= tournament && tournament.isActive ? 'checked' : '' %>>
            <label for="isActive" class="text-gray-300 text-sm font-bold">Tournoi Actif</label>
        </div>

        <div class="mb-4">
            <label for="coverImage" class="block text-gray-300 text-sm font-bold mb-2">Photo de couverture:</label>
            <input type="file" id="coverImage" name="coverImage" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white">
            <% if (tournament && tournament.coverImage) { %>
                <p class="mt-2 text-sm text-gray-400">Image actuelle :</p>
                <img src="<%= tournament.coverImage %>" alt="Photo de couverture" class="mt-2 w-48 h-auto rounded">
            <% } %>
        </div>
    </div>

    <!-- Section: Dates et Inscriptions -->
    <div class="glass-card p-6 rounded-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Dates et Inscriptions</h2>
        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <label for="date" class="block text-gray-300 text-sm font-bold mb-2">Date du Tournoi:</label>
                <input type="date" id="date" name="date" value="<%= tournament ? tournament.date : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
            </div>
            <div class="w-1/2">
                <label for="time" class="block text-gray-300 text-sm font-bold mb-2">Heure du Tournoi:</label>
                <input type="time" id="time" name="time" value="<%= tournament && tournament.time ? tournament.time : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white">
            </div>
        </div>

        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <label for="registrationStartDate" class="block text-gray-300 text-sm font-bold mb-2">Date de début des inscriptions:</label>
                <input type="date" id="registrationStartDate" name="registrationStartDate" value="<%= tournament && tournament.registrationStartDate ? tournament.registrationStartDate : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white">
            </div>
            <div class="w-1/2">
                <label for="registrationStartTime" class="block text-gray-300 text-sm font-bold mb-2">Heure de début des inscriptions:</label>
                <input type="time" id="registrationStartTime" name="registrationStartTime" value="<%= tournament && tournament.registrationStartTime ? tournament.registrationStartTime : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white">
            </div>
        </div>

        <div class="mb-6 flex items-center">
            <input type="checkbox" id="registrationsOpen" name="registrationsOpen" class="mr-2 leading-tight" <%= tournament && tournament.registrationsOpen ? 'checked' : '' %>>
            <label for="registrationsOpen" class="text-gray-300 text-sm font-bold">Inscriptions ouvertes</label>
        </div>
    </div>

    <!-- Section: Règles du Tournoi -->
    <div class="glass-card p-6 rounded-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Règles du Tournoi</h2>
        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <label for="maxTeams" class="block text-gray-300 text-sm font-bold mb-2">Nombre maximum d'équipes:</label>
                <input type="number" id="maxTeams" name="maxTeams" value="<%= tournament ? tournament.maxTeams : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1" required>
            </div>
            <div class="w-1/2">
                <label for="minPlayersPerTeam" class="block text-gray-300 text-sm font-bold mb-2">Nombre minimum de joueurs par équipe:</label>
                <input type="number" id="minPlayersPerTeam" name="minPlayersPerTeam" value="<%= tournament ? tournament.minPlayersPerTeam : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1" required>
            </div>
        </div>
        
        <div class="mb-4" id="waitingListSizeContainer">
            <label for="waitingListSize" class="block text-gray-300 text-sm font-bold mb-2">Nombre d'équipes autorisé en salle d'attente (0 pour désactiver la liste d'attente):</label>
            <input type="number" id="waitingListSize" name="waitingListSize" value="<%= tournament && tournament.waitingListSize !== undefined ? tournament.waitingListSize : '0' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="0">
        </div>

        <div class="mb-4">
            <label for="playersPerTeam" class="block text-gray-300 text-sm font-bold mb-2">Nombre maximum de joueurs par équipe:</label>
            <input type="number" id="playersPerTeam" name="playersPerTeam" value="<%= tournament ? tournament.playersPerTeam : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1" required>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label for="type" class="block text-gray-300 text-sm font-bold mb-2">Type de Tournoi:</label>
                <select id="type" name="type" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
                    <option value="4x4" <%= tournament && tournament.type === '4x4' ? 'selected' : '' %>>4x4</option>
                    <option value="2x2" <%= tournament && tournament.type === '2x2' ? 'selected' : '' %>>2x2</option>
                    <option value="6x6" <%= tournament && tournament.type === '6x6' ? 'selected' : '' %>>6x6</option>
                </select>
            </div>

            <div>
                <label for="mixity" class="block text-gray-300 text-sm font-bold mb-2">Mixité:</label>
                <select id="mixity" name="mixity" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
                    <option value="none" <%= tournament && tournament.mixity === 'none' ? 'selected' : '' %>>Aucune</option>
                    <option value="male_female" <%= tournament && tournament.mixity === 'male_female' ? 'selected' : '' %>>Homme/Femme</option>
                    <option value="other" <%= tournament && tournament.mixity === 'other' ? 'selected' : '' %>>Autre</option>
                </select>
            </div>
        </div>

        <div class="mb-4 flex items-center">
            <input type="checkbox" id="requiresFemalePlayer" name="requiresFemalePlayer" class="mr-2 leading-tight" <%= tournament && tournament.requiresFemalePlayer ? 'checked' : '' %>>
            <label for="requiresFemalePlayer" class="text-gray-300 text-sm font-bold">Requiert une joueuse</label>
        </div>        
    </div>

    <!-- Section: Paramètres des Matchs -->
    <div class="glass-card p-6 rounded-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Paramètres des Matchs</h2>
        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <label for="setsPerMatchPool" class="block text-gray-300 text-sm font-bold mb-2">Sets par match (Poules):</label>
                <input type="number" id="setsPerMatchPool" name="setsPerMatchPool" value="<%= tournament ? tournament.setsPerMatchPool : '1' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1">
            </div>
            <div class="w-1/2">
                <label for="pointsPerSetPool" class="block text-gray-300 text-sm font-bold mb-2">Points par set (Poules):</label>
                <input type="number" id="pointsPerSetPool" name="pointsPerSetPool" value="<%= tournament ? tournament.pointsPerSetPool : '21' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1">
            </div>
        </div>

        <div class="mb-4">
            <label for="matchFormat" class="block text-gray-300 text-sm font-bold mb-2">Format des matchs:</label>
            <select id="matchFormat" name="matchFormat" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
                <option value="aller" <%= tournament && tournament.matchFormat === 'aller' ? 'selected' : '' %>>Aller simple</option>
                <option value="aller_retour" <%= tournament && tournament.matchFormat === 'aller_retour' ? 'selected' : '' %>>Aller/retour</option>
            </select>
        </div>

        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <label for="maxTeamsPerPool" class="block text-gray-300 text-sm font-bold mb-2">Nombre maximum d'équipes par poule:</label>
                <input type="number" id="maxTeamsPerPool" name="maxTeamsPerPool" value="<%= tournament ? tournament.maxTeamsPerPool : '4' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="2">
            </div>
            <div class="w-1/2">
                <label for="teamsQualifiedPerPool" class="block text-gray-300 text-sm font-bold mb-2">Équipes qualifiées par poule:</label>
                <input type="number" id="teamsQualifiedPerPool" name="teamsQualifiedPerPool" value="<%= tournament ? tournament.teamsQualifiedPerPool : '2' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1">
            </div>
        </div>

        <div class="mb-6 flex items-center">
            <input type="checkbox" id="eliminationPhaseEnabled" name="eliminationPhaseEnabled" class="mr-2 leading-tight" <%= tournament && tournament.eliminationPhaseEnabled ? 'checked' : '' %>>
            <label for="eliminationPhaseEnabled" class="text-gray-300 text-sm font-bold">Activer la phase d'élimination</label>
        </div>

        <div id="eliminationPhaseSettings" class="<%= tournament && tournament.eliminationPhaseEnabled ? '' : 'hidden' %>">
            <div class="mb-4 flex space-x-4">
                <div class="w-1/2">
                    <label for="setsPerMatchElimination" class="block text-gray-300 text-sm font-bold mb-2">Sets par match (Élimination):</label>
                    <input type="number" id="setsPerMatchElimination" name="setsPerMatchElimination" value="<%= tournament ? tournament.setsPerMatchElimination : '3' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1">
                </div>
                <div class="w-1/2">
                    <label for="pointsPerSetElimination" class="block text-gray-300 text-sm font-bold mb-2">Points par set (Élimination):</label>
                    <input type="number" id="pointsPerSetElimination" name="pointsPerSetElimination" value="<%= tournament ? tournament.pointsPerSetElimination : '21' %>" class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="1" step="1">
                </div>
            </div>
            <div class="mb-6 flex items-center">
                <input type="checkbox" id="tieBreakEnabledElimination" name="tieBreakEnabledElimination" class="mr-2 leading-tight" <%= tournament && tournament.tieBreakEnabledElimination ? 'checked' : '' %>>
                <label for="tieBreakEnabledElimination" class="text-gray-300 text-sm font-bold">Activer le tie-break (Élimination)</label>
            </div>
        </div>

        <div class="mb-6 flex items-center">
            <input type="checkbox" id="tieBreakEnabledPools" name="tieBreakEnabledPools" class="mr-2 leading-tight" <%= tournament && tournament.tieBreakEnabledPools ? 'checked' : '' %>>
            <label for="tieBreakEnabledPools" class="text-gray-300 text-sm font-bold">Activer le tie-break (Poules)</label>
        </div>
    </div>

    <!-- Section: Détails Logistiques et Financiers -->
    <div class="glass-card p-6 rounded-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Détails Logistiques et Financiers</h2>
        <div class="mb-4">
            <label for="location" class="block text-gray-300 text-sm font-bold mb-2">Lieu:</label>
            <input type="text" id="location" name="location" value="<%= tournament ? tournament.location : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" required>
        </div>

        <div class="mb-4">
            <label for="fields" class="block text-gray-300 text-sm font-bold mb-2">Nombre de terrains:</label>
            <input type="number" id="fields" name="fields" value="<%= tournament ? tournament.fields : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="0">
        </div>

        <div class="mb-4">
            <label for="fee" class="block text-gray-300 text-sm font-bold mb-2">Frais d'inscription (€):</label>
            <input type="number" id="fee" name="fee" value="<%= tournament ? tournament.fee : '' %>" class="shadow appearance-none border rounded w-full py-2 px-3  leading-tight focus:outline-none focus:shadow-outline bg-gray-700 border-gray-600 text-white" min="0" step="0.01">
        </div>
    </div>

    <div class="flex items-center justify-end mt-8">
        <% if (tournament) { %>
            <a href="/admin/tournaments/<%= tournament.id %>/guaranteed-matches" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-4">
                Voir les matchs garantis
            </a>
        <% } %>
        <a href="/admin/tournaments" class="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800 mr-4">
            Annuler
        </a>
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            <%= tournament ? 'Mettre à jour' : 'Créer' %> le Tournoi
        </button>
    </div>
</form>
